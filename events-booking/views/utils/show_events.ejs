<%
// Funzione per formattare la data
function formatDateTime(inputDate) {
    const date = new Date(inputDate);
    const year = date.getFullYear();
    const month = (date.getMonth() + 1).toString().padStart(2, '0');
    const day = date.getDate().toString().padStart(2, '0');

    return `${year}/${month}/${day}`;
}
%>

<div id="eventModal" class="modal">
  <div class="modal-content">
    <span class="close">&times;</span>
    <h2>Event Details</h2>
    <div id="eventDetails"></div>
    <div id="event_img"></div>
    <label for="ticketQuantity">Ticket Quantity:</label>
    <input type="number" id="ticketQuantity" min="1" value="1">
    <button id="addToCartBtn">Add to Cart</button>
  </div>
</div>

<section class="container__event">
  <% if(events.length > 0) { %>
  <div class="card__container swiper">
     <div class="card__content">
        <div class="swiper-wrapper">
          <% events.forEach(function(event) { %>
           <article class="card__article swiper-slide">
              <div class="card__image">
                <img src="<%= event.image_URL %>" alt="Event Image" style="width:100%">
              </div>
              <div class="container_info_artist">
                <h4><b><%= event.artist.name %></b></h4>
                <p><%= event.title %></p>
                <p><%= event.city %> - <%= event.site %></p>
              </div>

              <div class="card__data">
                <span><i class="fa-solid fa-calendar"></i> <%= formatDateTime(event.date) %></span>
                <span><i class="fa-solid fa-couch"></i> <%= event.seats %></span>
                <span><i class="fa-solid fa-euro-sign"></i> <%= event.price_for_ticket %></span>

                <a href="#" class="card__button" onclick="openModal('<%= JSON.stringify(event) %>')">View More</a>
              </div>
           </article>
            <% }); %>
        </div>
     </div>

     <!-- Navigation buttons -->
     <div class="swiper-button-next">
      <i class="fa-solid fa-chevron-right"></i>
     </div>
     
     <div class="swiper-button-prev">
      <i class="fa-solid fa-chevron-left"></i>
     </div>

     <!-- Pagination -->
     <div class="swiper-pagination"></div>
  </div>
  <% } else { %>
    <h1>No events found</h1>
  <% } %>
</section>




<!--

<% if(events.length > 0) { %>
    <div class="container_event">
      <% events.forEach(function(event) { %>
        <div class="card" data-id="<%=event._id %>">
          <img src="<%= event.image_URL %>" alt="Event Image" style="width:100%">
          <div class="container_info_artist">
            <h4><b><%= event.artist.name %></b></h4>
            <p><%= event.title %></p>
            <p><%= event.city %> - <%= event.site %></p>
          </div>
          <div class="container_info_event">
            <span><i class="fa-solid fa-calendar"></i> <%= formatDateTime(event.date) %></span>
            <span><i class="fa-solid fa-couch"></i> <%= event.seats %></span>
            <span><i class="fa-solid fa-euro-sign"></i> <%= event.price_for_ticket %></span>
          </div>
        </div>
      <% }); %>
      </div>
    <% } else { %>
      <h1>No events found</h1>
    <% } %>

    -->


    <script src="/swiper.js"></script>
    <script>
      // Function to open the modal and populate it with event details
      function openModal(eventJSON) {
        const event = JSON.parse(eventJSON);
        // Get the event details based on the eventId
    
        // Populate the modal with event details
        const modal = document.getElementById("eventModal");
        const eventDetails = document.getElementById("eventDetails");
        eventDetails.innerHTML = `
          <h3>${event.title}</h3>
          <p>Artist: ${event.artist.name}</p>
          <p>Date: ${formatDateTime(event.date)}</p>
          <p>Seats: ${event.seats}</p>
          <p>Price: ${event.price_for_ticket}</p>
        `;
        const eventImg = document.getElementById("event_img");
        eventImg.innerHTML = `
          <img src="${event.image_URL}" alt="Event Image" style="width:100%">
        `;
    
        // Show the modal
        modal.style.display = "block";
      }
    
      // Function to close the modal
      function closeModal() {
        const modal = document.getElementById("eventModal");
        modal.style.display = "none";
      }
    
      // Add event listener to close button
      const closeButton = document.querySelector(".close");
      closeButton.addEventListener("click", closeModal);
    
      // Add event listener to "Add to Cart" button
      const addToCartButton = document.getElementById("addToCartBtn");
      addToCartButton.addEventListener("click", addToCart);
    
      // Function to add tickets to the cart
      function addToCart() {
        const ticketQuantity = document.getElementById("ticketQuantity").value;
        // Add the ticket quantity to the cart logic here
        // ...
        // Close the modal after adding to cart
        closeModal();
      }
    
      function formatDateTime(inputDate) {
        const date = new Date(inputDate);
        const year = date.getFullYear();
        const month = (date.getMonth() + 1).toString().padStart(2, '0');
        const day = date.getDate().toString().padStart(2, '0');
    
        return `${year}/${month}/${day}`;
    }
    
    </script>